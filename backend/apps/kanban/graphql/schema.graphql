"""
Root Query for GraphQL API - combines all read operations.

Inherits: apps.kanban.schema.Query (allTasks)
Returns: All tasks ordered by creation date (newest first)

Future: Add new app Query classes to inheritance list
"""
type Query {
  allTasks: [TaskType]
}

"""
GraphQL Type for Task
=====================

Extended to include checklists relationship.

Performance:
    - Uses prefetch_related for checklists and their items
    - Prevents N+1 queries when loading task with checklists
"""
type TaskType {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  title: String!
  description: String!
  status: KanbanTaskStatusChoices!
  category: String!
  priority: KanbanTaskPriorityChoices!
  order: Int!
  checklists: [ChecklistType!]!
}

"""
The `DateTime` scalar type represents a DateTime
value as specified by
[iso8601](https://en.wikipedia.org/wiki/ISO_8601).
"""
scalar DateTime

"""An enumeration."""
enum KanbanTaskStatusChoices {
  """To Do"""
  TODO

  """In Progress"""
  DOING

  """Waiting"""
  WAITING

  """Done"""
  DONE
}

"""An enumeration."""
enum KanbanTaskPriorityChoices {
  """P1 - Do First"""
  P1

  """P2 - Schedule"""
  P2

  """P3 - Quick Win"""
  P3

  """P4 - Backlog"""
  P4
}

"""
GraphQL Type for Checklist
===========================

Fields:
    - id, title, task
    - items: Related ChecklistItems (ordered by position)
    - progress: Calculated completion percentage (0-100)
    - createdAt, updatedAt

Performance:
    - Uses prefetch_related for items to avoid N+1 queries
    - Progress field is computed from database counts
"""
type ChecklistType {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  title: String!
  task: TaskType!
  items: [ChecklistItemType!]!
  progress: Int
}

"""
GraphQL Type for ChecklistItem
===============================

Fields:
    - id, text, completed, position
    - checklist: Parent checklist reference
    - createdAt, updatedAt

Performance:
    - Uses select_related for checklist to avoid N+1 queries
"""
type ChecklistItemType {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  text: String!
  completed: Boolean!
  position: Int!
  checklist: ChecklistType!
}

"""
Root Mutation for GraphQL API - combines all write operations.

Inherits: apps.kanban.schema.Mutation (createTask)

Security: All mutations must validate inputs and check permissions
Future: Add new app Mutation classes to inheritance list
"""
type Mutation {
  """Create a new task with validation."""
  createTask(category: String, order: Int, priority: TaskPriorityEnum, status: TaskStatusEnum, title: String!): CreateTask

  """Update an existing task with validation."""
  updateTask(category: String, description: String, id: ID!, order: Int, priority: TaskPriorityEnum, status: TaskStatusEnum, title: String): UpdateTask

  """Delete a task by ID."""
  deleteTask(id: ID!): DeleteTask

  """Create a new checklist for a task."""
  createChecklist(taskId: ID!, title: String!): CreateChecklist

  """Delete a checklist and all its items (CASCADE)."""
  deleteChecklist(checklistId: ID!): DeleteChecklist

  """
  Add a new item to a checklist. Auto-calculates position if not provided.
  """
  addChecklistItem(checklistId: ID!, position: Int, text: String!): AddChecklistItem

  """Toggle the completed state of a checklist item."""
  toggleChecklistItem(itemId: ID!): ToggleChecklistItem

  """Update text and/or completed state of a checklist item."""
  updateChecklistItem(completed: Boolean, itemId: ID!, text: String): UpdateChecklistItem

  """Delete a checklist item."""
  deleteChecklistItem(itemId: ID!): DeleteChecklistItem

  """Reorder all items in a checklist atomically using bulk_update."""
  reorderChecklistItems(checklistId: ID!, itemIds: [ID]!): ReorderChecklistItems
}

"""Create a new task with validation."""
type CreateTask {
  task: TaskType
  errors: [String]
}

"""GraphQL enum for Task.Priority choices."""
enum TaskPriorityEnum {
  P1
  P2
  P3
  P4
}

"""GraphQL enum for Task.Status choices with validation."""
enum TaskStatusEnum {
  TODO
  DOING
  WAITING
  DONE
}

"""Update an existing task with validation."""
type UpdateTask {
  task: TaskType
  errors: [String]
}

"""Delete a task by ID."""
type DeleteTask {
  success: Boolean
  deletedId: ID
  errors: [String]
}

"""Create a new checklist for a task."""
type CreateChecklist {
  checklist: ChecklistType
  errors: [String]
}

"""Delete a checklist and all its items (CASCADE)."""
type DeleteChecklist {
  success: Boolean
  deletedId: ID
  errors: [String]
}

"""
Add a new item to a checklist. Auto-calculates position if not provided.
"""
type AddChecklistItem {
  item: ChecklistItemType
  errors: [String]
}

"""Toggle the completed state of a checklist item."""
type ToggleChecklistItem {
  item: ChecklistItemType
  errors: [String]
}

"""Update text and/or completed state of a checklist item."""
type UpdateChecklistItem {
  item: ChecklistItemType
  errors: [String]
}

"""Delete a checklist item."""
type DeleteChecklistItem {
  success: Boolean
  deletedId: ID
  errors: [String]
}

"""Reorder all items in a checklist atomically using bulk_update."""
type ReorderChecklistItems {
  items: [ChecklistItemType]
  checklist: ChecklistType
  errors: [String]
}
